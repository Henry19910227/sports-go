## 簡要介紹
本專案是基於 Golang (gin + grpc) 開發的｜遊戲後端｜投注系統｜體育彩，用於專案演示與Demo，勿作為商業用途。
- 核心服務 (用戶服務｜賽事服務｜賠率服務｜投注服務｜訂單服務｜支付服務｜結算服務｜代理服務)
- 管理系統 (風控管理｜用戶管理｜賽事管理｜行銷與促銷管理｜報表管理｜支付管理｜代理管理)

## 系統架構概要圖

## 技術構成
- 後端：Gorilla、Golang Game Framework
- 資料庫：Mysql
- 緩存：Redis
- 消息隊列：Kafka
- 前端：iOS、Android

## 核心特性
- 中間層機制：支持 Middleware 鏈式調用，方便請求攔截、日誌記錄、權限驗證、錯誤處理等功能擴展，提升可維護性
- 靈活路由：支援 動態路由、路由分組、參數綁定，確保請求處理高效且靈活，適應不同遊戲場景需求
- 錯誤處理：內建 統一錯誤捕獲與恢復機制，可自訂錯誤處理策略，確保應用穩定運行，防止異常影響遊戲流程
- 資料處理：內建高效資料解析器與協議，可依需求自行實作解析器。
- 頻道管理：支持單播、群組廣播、房間內消息分發，適用於遊戲房間、即時聊天、數據推送等場景
- 連接管理：支援自動重連、心跳機制、連線超時檢測，確保遊戲過程不中斷
- 安全性：內建身份驗證、加密傳輸，確保通訊安全，防止惡意攻擊
- 高效消息推送：內建異步消息處理與事件驅動機制，支援 多人同步數據、遊戲狀態更新、實時通知

## 功能列表
- [x] 1.投注 (單場投注｜串關投注｜預約投注｜投注限額)
- [x] 2.入金系統 (銀行轉帳｜電子支付｜加密貨幣｜付款驗證｜異常檢查)
- [x] 3.出金系統 (出金處理｜異常檢查)
- [X] 4.風控 (多帳戶套利檢測｜非法帳戶檢測｜異常投注檢測｜黑名單)
- [X] 5.數據監控 (日誌搜集｜系統性能監控｜賠率監控｜風控監控｜投注數據監控)
- [X] 3.返水 (VIP 返水/活動返水)
- [X] 4.結算 (交易日誌紀錄/異常處理/賠率計算/開獎結果)
- [X] 6.聊天室

## 投注系統
### 流程
1️⃣ 玩家下注 ➝ 2️⃣ 餘額檢查 ➝ 3️⃣ 訂單系統 ➝ 4️⃣ 風控檢查 ➝ 5️⃣ 等待比賽 ➝ 6️⃣ 結算 ➝ 7️⃣ 更新錢包

## 結算系統
### 流程
1️⃣ 比賽結果收集 ➝ 2️⃣ 赔率校驗 ➝ 3️⃣ 訂單結算 ➝ 4️⃣ 計算獎金 ➝
5️⃣ 更新錢包 ➝ 6️⃣ 通知玩家 ➝ 7️⃣ 風控檢測
### 1.比賽結果搜集
* 數據來源：第三方 API（如 BetRadar、SportRadar）
* 功能：
監聽比賽結束事件。
解析 比賽結果、比分、紅黃牌 等數據。
比對玩家的投注項目。
### 2.賠率校驗
1️⃣ 比對投注時的賠率與最終賠率，差異過大則觸發審查。
2️⃣ 延遲數據監控，防止玩家利用數據同步延遲套利。
3️⃣ 記錄異常賠率變動，以供後續分析。



## 返水系統
### 流程
1️⃣ 玩家下注 ➝ 2️⃣ 訂單系統記錄 ➝ 3️⃣ 返水計算 ➝ 4️⃣ 風控檢查 ➝ 5️⃣ 發放返水
### 返水類型
- 一般返水
- VIP 返水
- 即時返水
- 週/月結返水
### 返水系統架構
+--------------------------------------+
|          返水系統（Rebate Service）   |
+--------------------------------------+
|             |              |
v             v              v
+-----------------+  +----------------+  +----------------+
| 訂單服務（Order） |  | 錢包服務（Wallet） |  |  風控系統（Risk） |
+-----------------+  +----------------+  +----------------+
|             |              |
v             v              v
+--------------------------------------+
|        數據分析與後台管理（Admin）     |
+--------------------------------------+
### 風控檢查
- 檢查對沖投注
- 異常返水監測
- 套利玩家黑名單


## 核心監控指標
### 投注數據監控
監測所有投注相關的數據，確保無異常行為：
- 投注量：每秒投注數量
- 熱門賽事：熱門比賽投注量
- 單場最高投注額：偵測單場投注是否異常
- 投注勝率：偵測是否出現高於正常的勝率

### 賠率監控
監測賠率的變化，防止套利或賠率錯誤：
- 賠率變動頻率
- 與市場平均賠率偏差
- 異常賠率檢測
- 賠率閥值告警

### 交易監控
監控充值、提款、投注流水，防止異常交易行為：
- 異常提款
- 存提頻率異常
- 洗碼行為

### 告警與通知
當系統偵測到異常行為時的通知方式
- Email
- Slack or Telegram Webhook
- SMS